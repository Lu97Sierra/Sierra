import { IDisposable } from '../../../base/common/lifecycle';
import { URI } from '../../../base/common/uri';
import { IRequestHandler } from '../../../base/common/worker/simpleWorker';
import { IPosition } from '../core/position';
import { IRange, Range } from '../core/range';
import { IChange } from '../editorCommon';
import { IWordAtPosition } from '../model';
import { IModelChangedEvent } from '../model/mirrorTextModel';
import { IInplaceReplaceSupportResult, ILink, TextEdit } from '../modes';
import { ILinkComputerTarget } from '../modes/linkComputer';
import { IDiffComputationResult } from './editorWorkerService';
import { EditorWorkerHost } from './editorWorkerServiceImpl';
export interface IMirrorModel {
    readonly uri: URI;
    readonly version: number;
    getValue(): string;
}
export interface IWorkerContext<H = undefined> {
    /**
     * A proxy to the main thread host object.
     */
    host: H;
    /**
     * Get all available mirror models in this worker.
     */
    getMirrorModels(): IMirrorModel[];
}
/**
 * @internal
 */
export interface IRawModelData {
    url: string;
    versionId: number;
    lines: string[];
    EOL: string;
}
/**
 * @internal
 */
export interface ICommonModel extends ILinkComputerTarget, IMirrorModel {
    uri: URI;
    version: number;
    eol: string;
    getValue(): string;
    getLinesContent(): string[];
    getLineCount(): number;
    getLineContent(lineNumber: number): string;
    getLineWords(lineNumber: number, wordDefinition: RegExp): IWordAtPosition[];
    words(wordDefinition: RegExp): Iterable<string>;
    getWordUntilPosition(position: IPosition, wordDefinition: RegExp): IWordAtPosition;
    getValueInRange(range: IRange): string;
    getWordAtPosition(position: IPosition, wordDefinition: RegExp): Range | null;
    offsetAt(position: IPosition): number;
    positionAt(offset: number): IPosition;
}
/**
 * @internal
 */
export interface IForeignModuleFactory {
    (ctx: IWorkerContext, createData: any): any;
}
/**
 * @internal
 */
export declare class EditorSimpleWorker implements IRequestHandler, IDisposable {
    _requestHandlerBrand: any;
    private readonly _host;
    private _models;
    private readonly _foreignModuleFactory;
    private _foreignModule;
    constructor(host: EditorWorkerHost, foreignModuleFactory: IForeignModuleFactory | null);
    dispose(): void;
    protected _getModel(uri: string): ICommonModel;
    private _getModels;
    acceptNewModel(data: IRawModelData): void;
    acceptModelChanged(strURL: string, e: IModelChangedEvent): void;
    acceptRemovedModel(strURL: string): void;
    computeDiff(originalUrl: string, modifiedUrl: string, ignoreTrimWhitespace: boolean, maxComputationTime: number): Promise<IDiffComputationResult | null>;
    private _modelsAreIdentical;
    computeDirtyDiff(originalUrl: string, modifiedUrl: string, ignoreTrimWhitespace: boolean): Promise<IChange[] | null>;
    private static readonly _diffLimit;
    computeMoreMinimalEdits(modelUrl: string, edits: TextEdit[]): Promise<TextEdit[]>;
    computeLinks(modelUrl: string): Promise<ILink[] | null>;
    private static readonly _suggestionsLimit;
    textualSuggest(modelUrls: string[], leadingWord: string | undefined, wordDef: string, wordDefFlags: string): Promise<{
        words: string[];
        duration: number;
    } | null>;
    computeWordRanges(modelUrl: string, range: IRange, wordDef: string, wordDefFlags: string): Promise<{
        [word: string]: IRange[];
    }>;
    navigateValueSet(modelUrl: string, range: IRange, up: boolean, wordDef: string, wordDefFlags: string): Promise<IInplaceReplaceSupportResult | null>;
    loadForeignModule(moduleId: string, createData: any, foreignHostMethods: string[]): Promise<string[]>;
    fmr(method: string, args: any[]): Promise<any>;
}
/**
 * Called on the worker side
 * @internal
 */
export declare function create(host: EditorWorkerHost): IRequestHandler;
